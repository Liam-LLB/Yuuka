<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Yuukajeux - Hub</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <style>
    :root {
      --bg: #0b1224;
      --panel: rgba(30, 41, 59, 0.9);
      --card: rgba(23, 31, 50, 0.9);
      --muted: #cbd5e1;
      --text: #e2e8f0;
      --accent: #7c3aed;
      --accent-2: #22d3ee;
      --accent-3: #f59e0b;
      --border: rgba(148, 163, 184, 0.25);
      --success: #22c55e;
      --warning: #f97316;
      --danger: #ef4444;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background:
        radial-gradient(circle at 15% 25%, rgba(124, 58, 237, 0.16), transparent 28%),
        radial-gradient(circle at 80% 10%, rgba(34, 211, 238, 0.18), transparent 25%),
        linear-gradient(135deg, #0b1224 0%, #0f172a 55%, #0b1224 100%);
      color: var(--text);
      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, sans-serif;
      min-height: 100vh;
    }

    nav {
      background: rgba(12, 16, 32, 0.92);
      backdrop-filter: blur(8px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      padding: 16px 20px;
      position: sticky;
      top: 0;
      z-index: 10;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
    }

    nav a {
      color: white;
      text-decoration: none;
      padding: 10px 14px;
      font-weight: 600;
      font-size: 0.95rem;
      border-radius: 12px;
      transition: all 0.25s ease;
    }

    nav a:hover {
      background: rgba(124, 58, 237, 0.14);
      color: #ede9fe;
    }

    .center-menu {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex: 1;
      flex-wrap: wrap;
    }

    main {
      width: 100%;
      max-width: 1180px;
      margin: 0 auto;
      padding: 40px 16px 80px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .card {
      background: var(--card);
      border-radius: 18px;
      border: 1px solid var(--border);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.35);
      padding: 22px;
      backdrop-filter: blur(8px);
    }

    .hero {
      background: radial-gradient(circle at 20% 30%, rgba(124, 58, 237, 0.22), transparent 35%),
                  radial-gradient(circle at 90% 10%, rgba(34, 211, 238, 0.18), transparent 32%),
                  var(--panel);
      position: relative;
      overflow: hidden;
    }

    .hero::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(120deg, rgba(255, 255, 255, 0.05), transparent 60%);
      pointer-events: none;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(124, 58, 237, 0.14);
      color: #e9d5ff;
      font-weight: 700;
      border: 1px solid rgba(124, 58, 237, 0.35);
      width: fit-content;
    }

    .hero h1 {
      margin: 12px 0 6px;
      font-size: clamp(26px, 4vw, 40px);
      letter-spacing: 0.4px;
    }

    .hero p {
      margin: 0 0 18px;
      color: var(--muted);
      line-height: 1.6;
    }

    .rule-cloud {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap: 10px;
      margin-top: 8px;
    }

    .rule-bubble {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.02));
      border: 1px solid rgba(255, 255, 255, 0.07);
      border-radius: 16px;
      padding: 12px 12px;
      display: flex;
      gap: 10px;
      align-items: center;
      color: #e2e8f0;
    }

    .rule-bubble i {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      background: rgba(124, 58, 237, 0.18);
      color: #e9d5ff;
    }

    .rule-bubble strong { display: block; font-size: 1rem; }
    .rule-bubble span { color: var(--muted); font-size: 0.95rem; }

    .metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 12px;
      margin-top: 14px;
    }

    .metric-card {
      background: linear-gradient(135deg, rgba(124, 58, 237, 0.15), rgba(12, 18, 32, 0.9));
      border: 1px solid rgba(124, 58, 237, 0.28);
      border-radius: 14px;
      padding: 14px;
      display: grid;
      gap: 6px;
      position: relative;
    }

    .metric-card .label { color: var(--muted); font-size: 0.95rem; }
    .metric-card .value { font-size: 1.4rem; font-weight: 800; }

    .progress-bar {
      height: 12px;
      background: rgba(255, 255, 255, 0.06);
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #22d3ee, #a855f7);
      transition: width 0.35s ease;
    }

    .status-chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 0.85rem;
      background: rgba(255, 255, 255, 0.06);
      color: #e2e8f0;
    }

    .status-chip.success { color: #bbf7d0; background: rgba(34, 197, 94, 0.12); border: 1px solid rgba(34, 197, 94, 0.4); }
    .status-chip.pending { color: #fed7aa; background: rgba(234, 179, 8, 0.1); border: 1px solid rgba(234, 179, 8, 0.3); }

    .unlock-card {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 12px;
      align-items: center;
      background: linear-gradient(135deg, rgba(34, 211, 238, 0.18), rgba(124, 58, 237, 0.2));
      border: 1px solid rgba(34, 211, 238, 0.28);
    }

    .unlock-description { color: var(--muted); margin: 0; }

    .lock-button {
      width: 100%;
      padding: 16px 18px;
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(0, 0, 0, 0.15);
      color: #e2e8f0;
      font-weight: 800;
      font-size: 1rem;
      cursor: not-allowed;
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .lock-button.unlocked {
      background: linear-gradient(135deg, #22c55e, #0ea5e9);
      box-shadow: 0 12px 30px rgba(34, 197, 94, 0.4);
      border-color: rgba(34, 197, 94, 0.6);
      cursor: pointer;
    }

    .lock-button.unlocked:hover { transform: translateY(-2px); }

    .games-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 14px;
    }

    .game-card {
      background: linear-gradient(135deg, rgba(124, 58, 237, 0.12), rgba(11, 18, 36, 0.95));
      border: 1px solid rgba(124, 58, 237, 0.18);
      border-radius: 14px;
      padding: 16px;
      display: grid;
      gap: 8px;
      transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .game-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 14px 34px rgba(0, 0, 0, 0.4);
      border-color: rgba(34, 211, 238, 0.35);
    }

    .game-top {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .game-icon {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      background: rgba(124, 58, 237, 0.2);
      color: #e9d5ff;
      font-size: 18px;
    }

    .game-card h3 { margin: 0; }
    .game-card p { margin: 0; color: var(--muted); line-height: 1.5; }

    .meta-row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .pill-small {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.06);
      color: #e2e8f0;
      font-weight: 700;
      font-size: 0.9rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .btn {
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid rgba(124, 58, 237, 0.35);
      background: rgba(124, 58, 237, 0.16);
      color: #e2e8f0;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn:hover { background: rgba(124, 58, 237, 0.28); }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }

    .game-screen {
      margin-top: 10px;
      display: grid;
      gap: 10px;
    }

    .actions { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    .badge { background: rgba(255, 255, 255, 0.08); padding: 8px 12px; border-radius: 12px; color: var(--muted); }
    .tile { padding: 16px; border-radius: 12px; border: 1px solid var(--border); background: rgba(255, 255, 255, 0.04); cursor: pointer; text-align: center; }
    .tile.active { background: rgba(34, 211, 238, 0.2); border-color: rgba(34, 211, 238, 0.6); }
    .tile.correct { background: rgba(34, 197, 94, 0.18); border-color: rgba(34, 197, 94, 0.6); }
    .tile.wrong { background: rgba(239, 68, 68, 0.18); border-color: rgba(239, 68, 68, 0.6); }

    .board { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 10px; }

    .game-block input { width: 100%; padding: 12px 10px; border-radius: 12px; border: 1px solid var(--border); background: rgba(255, 255, 255, 0.04); color: var(--text); }

    .hidden { display: none; }

    .note { color: var(--muted); margin: 0; }

    .reward { background: linear-gradient(120deg, rgba(34, 197, 94, 0.15), rgba(14, 165, 233, 0.15)); border: 1px solid rgba(34, 197, 94, 0.35); color: #dcfce7; text-align: center; }
  </style>
</head>
<body>
  <nav>
    <a href="index.html"><i class="fas fa-house"></i> Yuukaccueil</a>
    <div class="center-menu">
      <a href="bouton1.html"><i class="fas fa-camera-retro"></i> Yuukalerie</a>
      <a href="bouton2.html"><i class="fas fa-music"></i> Yuusiques</a>
      <a href="bouton3.html"><i class="fas fa-mars"></i> Yuugars</a>
      <a href="bouton4.html"><i class="fas fa-heart-circle-bolt"></i> Yuukafe place</a>
      <a href="bouton5.html"><i class="fas fa-calendar-alt"></i> Yuukalendrier</a>
      <a href="bouton6.html"><i class="fas fa-gamepad"></i> Yuukajeux</a>
    </div>
    <a href="index.html"><i class="fas fa-sign-out-alt"></i> Yuukoff</a>
  </nav>

  <main>
    <section class="card hero">
      <div class="pill"><i class="fas fa-sparkles"></i> Page 6 • Hub Yuukajeux</div>
      <h1>Refonte du hub : règles claires, progression visible, actions immédiates.</h1>
      <p>Retrouve ici chaque mini-jeu avec un accès direct. Les règles et indicateurs sont regroupés en bulles modernes pour que tu saches exactement quoi faire pour débloquer la suite.</p>

      <div class="rule-cloud">
        <div class="rule-bubble">
          <i class="fas fa-flag-checkered"></i>
          <div><strong>Valide les 6 défis</strong><span>Chaque mini-jeu doit être gagné pour ouvrir la suite.</span></div>
        </div>
        <div class="rule-bubble">
          <i class="fas fa-microchip"></i>
          <div><strong>Progression locale</strong><span>Scores et validations sauvegardés dans ton navigateur.</span></div>
        </div>
        <div class="rule-bubble">
          <i class="fas fa-gauge-high"></i>
          <div><strong>Barre de progression</strong><span>Remplis-la à 100% pour déverrouiller le bouton final.</span></div>
        </div>
        <div class="rule-bubble">
          <i class="fas fa-rotate"></i>
          <div><strong>Rejoue à volonté</strong><span>Améliore tes scores, les meilleurs essais sont conservés.</span></div>
        </div>
      </div>

      <div class="metrics">
        <div class="metric-card">
          <div class="label">Total de points</div>
          <div class="value" id="totalPoints">0 pts</div>
          <div class="status-chip" id="completedCount">0 / 6 jeux validés</div>
        </div>
        <div class="metric-card">
          <div class="label">Progression globale</div>
          <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
          <div class="value" id="progressText">0%</div>
        </div>
        <div class="metric-card">
          <div class="label">Récompense</div>
          <div class="value" id="rewardStatus">Bloquée</div>
          <div class="status-chip pending" id="rewardHint"><i class="fas fa-lock"></i> Termine tout pour déverrouiller</div>
        </div>
      </div>
    </section>

    <section class="card unlock-card">
      <div>
        <h2 style="margin: 0 0 6px">Portail final</h2>
        <p class="unlock-description">Une fois les six mini-jeux gagnés, le bouton se déverrouille et t’emmène vers la page finale où tu pourras découvrir la suite.</p>
        <p class="note" id="unlockNote">Encore quelques victoires avant l’ouverture.</p>
      </div>
      <button class="lock-button" id="finalButton" disabled>
        <i class="fas fa-lock"></i>
        <span>Portail verrouillé</span>
      </button>
    </section>

    <section class="games-grid" id="hubView">
      <article class="game-card">
        <div class="game-top">
          <div class="game-icon"><i class="fas fa-bolt"></i></div>
          <div>
            <h3>YuukaFlash</h3>
            <p>Réflexe éclair : clique dès que le signal apparaît.</p>
          </div>
        </div>
        <div class="meta-row">
          <span class="pill-small">Jusqu’à 30 pts</span>
          <span class="status-chip pending" id="status-reflex">À valider</span>
          <span class="pill-small" id="best-reflex">Meilleur : 0 pts</span>
        </div>
        <button class="btn" data-game="reflex">Accéder au mini-jeu</button>
      </article>

      <article class="game-card">
        <div class="game-top">
          <div class="game-icon"><i class="fas fa-brain"></i></div>
          <div>
            <h3>Yuukolor</h3>
            <p>Mémoire chroma : reproduis la séquence de couleurs.</p>
          </div>
        </div>
        <div class="meta-row">
          <span class="pill-small">25 pts</span>
          <span class="status-chip pending" id="status-memory">À valider</span>
          <span class="pill-small" id="best-memory">Meilleur : 0 pts</span>
        </div>
        <button class="btn" data-game="memory">Accéder au mini-jeu</button>
      </article>

      <article class="game-card">
        <div class="game-top">
          <div class="game-icon"><i class="fas fa-question-circle"></i></div>
          <div>
            <h3>Yuukwizz</h3>
            <p>Mini-quiz express en trois questions.</p>
          </div>
        </div>
        <div class="meta-row">
          <span class="pill-small">Jusqu’à 30 pts</span>
          <span class="status-chip pending" id="status-quiz">À valider</span>
          <span class="pill-small" id="best-quiz">Meilleur : 0 pts</span>
        </div>
        <button class="btn" data-game="quiz">Accéder au mini-jeu</button>
      </article>

      <article class="game-card">
        <div class="game-top">
          <div class="game-icon"><i class="fas fa-font"></i></div>
          <div>
            <h3>Yuukagram</h3>
            <p>Réarrange les lettres pour trouver le mot mystère.</p>
          </div>
        </div>
        <div class="meta-row">
          <span class="pill-small">25 pts</span>
          <span class="status-chip pending" id="status-anagram">À valider</span>
          <span class="pill-small" id="best-anagram">Meilleur : 0 pts</span>
        </div>
        <button class="btn" data-game="anagram">Accéder au mini-jeu</button>
      </article>

      <article class="game-card">
        <div class="game-top">
          <div class="game-icon"><i class="fas fa-key"></i></div>
          <div>
            <h3>Yuukode</h3>
            <p>Devine le code secret en un minimum d’essais.</p>
          </div>
        </div>
        <div class="meta-row">
          <span class="pill-small">25 pts</span>
          <span class="status-chip pending" id="status-code">À valider</span>
          <span class="pill-small" id="best-code">Meilleur : 0 pts</span>
        </div>
        <button class="btn" data-game="code">Accéder au mini-jeu</button>
      </article>

      <article class="game-card">
        <div class="game-top">
          <div class="game-icon"><i class="fas fa-hand-pointer"></i></div>
          <div>
            <h3>Yuukadash</h3>
            <p>Challenge clicker : clique un maximum en 10 secondes.</p>
          </div>
        </div>
        <div class="meta-row">
          <span class="pill-small">Jusqu’à 30 pts</span>
          <span class="status-chip pending" id="status-clicker">À valider</span>
          <span class="pill-small" id="best-clicker">Meilleur : 0 pts</span>
        </div>
        <button class="btn" data-game="clicker">Accéder au mini-jeu</button>
      </article>
    </section>

    <!-- Écrans de jeux -->
    <section class="card game-screen hidden" id="screen-reflex">
      <div class="actions">
        <button class="btn" id="backFromReflex"><i class="fas fa-chevron-left"></i> Retour au hub</button>
        <span class="pill-small">Jusqu’à 30 pts • Réussite si réaction &lt; 900 ms</span>
      </div>
      <h2>YuukaFlash</h2>
      <p>Attends le signal bleu et clique immédiatement.</p>
      <div class="actions">
        <button class="btn" id="reflexStart">Lancer</button>
        <span id="reflexStatus" class="status-chip pending">En attente</span>
      </div>
      <div id="reflexTarget" class="tile">Attends le signal…</div>
      <div class="pill-small" id="reflexScore">Meilleur : 0 pts</div>
    </section>

    <section class="card game-screen hidden" id="screen-memory">
      <div class="actions">
        <button class="btn" id="backFromMemory"><i class="fas fa-chevron-left"></i> Retour au hub</button>
        <span class="pill-small">25 pts • Séquence exacte requise</span>
      </div>
      <h2>Yuukolor</h2>
      <p>Observe la séquence, puis reproduis-la.</p>
      <div class="actions">
        <button class="btn" id="memoryStart">Montrer la séquence</button>
        <span id="memoryStatus" class="status-chip pending">En attente</span>
      </div>
      <div class="board" id="memoryBoard">
        <div class="tile" data-color="cyan">Cyan</div>
        <div class="tile" data-color="rose">Rose</div>
        <div class="tile" data-color="indigo">Indigo</div>
        <div class="tile" data-color="lime">Lime</div>
      </div>
      <div class="pill-small" id="memoryScore">Meilleur : 0 pts</div>
    </section>

    <section class="card game-screen hidden" id="screen-quiz">
      <div class="actions">
        <button class="btn" id="backFromQuiz"><i class="fas fa-chevron-left"></i> Retour au hub</button>
        <span class="pill-small">Jusqu’à 30 pts • Sans faute pour valider</span>
      </div>
      <h2>Yuukwizz</h2>
      <p>Réponds correctement aux 3 questions.</p>
      <div id="quizArea">
        <div id="quizQuestion">Prêt à commencer ?</div>
        <div class="actions" id="quizOptions"></div>
      </div>
      <div class="actions">
        <button class="btn" id="quizStart">Démarrer le quiz</button>
        <span id="quizStatus" class="status-chip pending">En attente</span>
      </div>
      <div class="pill-small" id="quizScore">Meilleur : 0 pts</div>
    </section>

    <section class="card game-screen hidden" id="screen-anagram">
      <div class="actions">
        <button class="btn" id="backFromAnagram"><i class="fas fa-chevron-left"></i> Retour au hub</button>
        <span class="pill-small">25 pts • 1 essai réussi = validé</span>
      </div>
      <h2>Yuukagram</h2>
      <p>Réarrange les lettres pour retrouver le mot Yuuka caché.</p>
      <div class="game-block">
        <div class="badge" id="anagramScramble">YUUKA</div>
        <input id="anagramInput" type="text" placeholder="Ta réponse" />
        <div class="actions">
          <button class="btn" id="anagramCheck">Valider</button>
          <button class="btn" id="anagramNext">Nouvelle grille</button>
        </div>
        <div class="status-chip pending" id="anagramStatus">En attente</div>
        <div class="pill-small" id="anagramScore">Meilleur : 0 pts</div>
      </div>
    </section>

    <section class="card game-screen hidden" id="screen-code">
      <div class="actions">
        <button class="btn" id="backFromCode"><i class="fas fa-chevron-left"></i> Retour au hub</button>
        <span class="pill-small">25 pts • 5 essais maximum</span>
      </div>
      <h2>Yuukode</h2>
      <p>Devine le code secret (1 à 20) en 5 essais maximum.</p>
      <div class="game-block">
        <input id="codeInput" type="number" min="1" max="20" placeholder="1-20" />
        <div class="actions">
          <button class="btn" id="codeTry">Proposer</button>
          <button class="btn" id="codeRestart">Nouveau code</button>
        </div>
        <div class="status-chip pending" id="codeStatus">En attente</div>
        <div class="pill-small" id="codeScore">Meilleur : 0 pts</div>
      </div>
    </section>

    <section class="card game-screen hidden" id="screen-clicker">
      <div class="actions">
        <button class="btn" id="backFromClicker"><i class="fas fa-chevron-left"></i> Retour au hub</button>
        <span class="pill-small">Jusqu’à 30 pts • Réussite à 20 clics</span>
      </div>
      <h2>Yuukadash</h2>
      <p>Tu as 10 secondes pour cliquer un maximum de fois.</p>
      <div class="game-block">
        <div class="badge" id="clickerTimer">10s</div>
        <div class="badge" id="clickerCount">0 clic</div>
        <div class="actions">
          <button class="btn" id="clickerStart">Lancer</button>
          <button class="btn" id="clickerTap">Clique ici</button>
        </div>
        <div class="status-chip pending" id="clickerStatus">En attente</div>
        <div class="pill-small" id="clickerScore">Meilleur : 0 pts</div>
      </div>
    </section>

    <section class="card reward hidden" id="rewardCard">
      <h2>Récompense débloquée</h2>
      <p>Bravo, tu as validé tous les mini-jeux. Le portail final est désormais ouvert.</p>
    </section>
  </main>

  <script>
    const STORAGE_KEY = "yuukajeuxProgress";
    const games = {
      reflex: { name: "YuukaFlash", max: 30 },
      memory: { name: "Yuukolor", max: 25 },
      quiz: { name: "Yuukwizz", max: 30 },
      anagram: { name: "Yuukagram", max: 25 },
      code: { name: "Yuukode", max: 25 },
      clicker: { name: "Yuukadash", max: 30 },
    };

    let state = {
      scores: { reflex: 0, memory: 0, quiz: 0, anagram: 0, code: 0, clicker: 0 },
      completed: { reflex: false, memory: false, quiz: false, anagram: false, code: false, clicker: false },
    };

    const totalGames = Object.keys(games).length;

    function loadState() {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) {
        try {
          const parsed = JSON.parse(stored);
          state = { ...state, ...parsed };
        } catch (_) { /* ignore */ }
      }
      // Ensure all keys exist even if l’ancien stockage était partiel
      for (const key of Object.keys(games)) {
        if (!(key in state.scores)) state.scores[key] = 0;
        if (!(key in state.completed)) state.completed[key] = false;
      }
    }

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    const rewardStatus = document.getElementById("rewardStatus");
    const rewardHint = document.getElementById("rewardHint");
    const rewardCard = document.getElementById("rewardCard");
    const finalButton = document.getElementById("finalButton");
    const unlockNote = document.getElementById("unlockNote");

    function updateCardState(key) {
      const statusChip = document.getElementById(`status-${key}`);
      const bestChip = document.getElementById(`best-${key}`);
      if (statusChip) {
        if (state.completed[key]) {
          statusChip.textContent = "Validé";
          statusChip.classList.add("success");
          statusChip.classList.remove("pending");
        } else {
          statusChip.textContent = "À valider";
          statusChip.classList.add("pending");
          statusChip.classList.remove("success");
        }
      }
      if (bestChip) bestChip.textContent = `Meilleur : ${state.scores[key]} pts`;
    }

    function updateScoreboard() {
      const totalPoints = Object.values(state.scores).reduce((a, b) => a + b, 0);
      const completedCount = Object.values(state.completed).filter(Boolean).length;
      const progress = Math.round((completedCount / totalGames) * 100);

      document.getElementById("totalPoints").textContent = `${totalPoints} pts`;
      document.getElementById("completedCount").textContent = `${completedCount} / ${totalGames} jeux validés`;
      document.getElementById("progressText").textContent = `${progress}%`;
      document.getElementById("progressFill").style.width = `${progress}%`;

      if (completedCount === totalGames) {
        rewardStatus.textContent = "Débloquée";
        rewardStatus.classList.add("success");
        rewardStatus.classList.remove("pending");
        rewardHint.innerHTML = '<i class="fas fa-unlock"></i> Prêt pour la page finale';
        rewardHint.classList.add("success");
        rewardHint.classList.remove("pending");
        rewardCard.classList.remove("hidden");
        finalButton.disabled = false;
        finalButton.classList.add("unlocked");
        finalButton.innerHTML = '<i class="fas fa-unlock"></i><span>Accéder à la page finale</span>';
        unlockNote.textContent = "Tout est validé, tu peux ouvrir le portail.";
      } else {
        rewardStatus.textContent = "Bloquée";
        rewardStatus.classList.remove("success");
        rewardHint.innerHTML = '<i class="fas fa-lock"></i> Termine tout pour déverrouiller';
        rewardHint.classList.add("pending");
        rewardCard.classList.add("hidden");
        finalButton.disabled = true;
        finalButton.classList.remove("unlocked");
        finalButton.innerHTML = '<i class="fas fa-lock"></i><span>Portail verrouillé</span>';
        unlockNote.textContent = "Encore quelques victoires avant l’ouverture.";
      }

      document.getElementById("reflexScore").textContent = `Meilleur : ${state.scores.reflex} pts`;
      document.getElementById("memoryScore").textContent = `Meilleur : ${state.scores.memory} pts`;
      document.getElementById("quizScore").textContent = `Meilleur : ${state.scores.quiz} pts`;
      document.getElementById("anagramScore").textContent = `Meilleur : ${state.scores.anagram} pts`;
      document.getElementById("codeScore").textContent = `Meilleur : ${state.scores.code} pts`;
      document.getElementById("clickerScore").textContent = `Meilleur : ${state.scores.clicker} pts`;

      Object.keys(games).forEach(updateCardState);
    }

    // Navigation jeux
    const screens = Array.from(document.querySelectorAll(".game-screen"));
    const hubView = document.getElementById("hubView");

    function showHub() {
      screens.forEach(s => s.classList.add("hidden"));
      hubView.classList.remove("hidden");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function goToGame(id) {
      hubView.classList.add("hidden");
      screens.forEach(s => s.classList.add("hidden"));
      const target = document.getElementById(`screen-${id}`);
      if (target) {
        target.classList.remove("hidden");
        target.scrollIntoView({ behavior: "smooth" });
      }
    }

    document.querySelectorAll('[data-game]').forEach(btn => {
      btn.addEventListener("click", () => goToGame(btn.dataset.game));
    });

    document.getElementById("backFromReflex").addEventListener("click", showHub);
    document.getElementById("backFromMemory").addEventListener("click", showHub);
    document.getElementById("backFromQuiz").addEventListener("click", showHub);
    document.getElementById("backFromAnagram").addEventListener("click", showHub);
    document.getElementById("backFromCode").addEventListener("click", showHub);
    document.getElementById("backFromClicker").addEventListener("click", showHub);

    finalButton.addEventListener("click", () => {
      if (finalButton.disabled) return;
      window.location.href = "finale.html";
    });

    // Réflexe éclair
    const reflexStartBtn = document.getElementById("reflexStart");
    const reflexTarget = document.getElementById("reflexTarget");
    const reflexStatus = document.getElementById("reflexStatus");
    let reflexTimeout;
    let reflexStartTime = 0;
    let reflexReady = false;

    function resetReflex() {
      clearTimeout(reflexTimeout);
      reflexReady = false;
      reflexTarget.textContent = "Attends le signal…";
      reflexTarget.classList.remove("active", "correct", "wrong");
      reflexStartBtn.disabled = false;
    }

    reflexStartBtn.addEventListener("click", () => {
      resetReflex();
      reflexStatus.textContent = "Prépare-toi…";
      reflexStatus.classList.remove("success");
      reflexStatus.classList.add("pending");
      reflexStartBtn.disabled = true;
      reflexTimeout = setTimeout(() => {
        reflexTarget.textContent = "Clique maintenant !";
        reflexTarget.classList.add("active");
        reflexReady = true;
        reflexStartTime = performance.now();
      }, 1000 + Math.random() * 2000);
    });

    reflexTarget.addEventListener("click", () => {
      if (!reflexReady) {
        reflexStatus.textContent = "Trop tôt !";
        reflexStatus.classList.remove("success");
        reflexStatus.classList.add("pending");
        resetReflex();
        return;
      }
      const reaction = performance.now() - reflexStartTime;
      reflexTarget.classList.remove("active");
      reflexReady = false;

      const points = Math.max(5, Math.min(30, Math.round(30 - reaction / 30)));
      if (reaction <= 900) {
        reflexStatus.textContent = `Validé : ${Math.round(reaction)} ms`;
        reflexStatus.classList.add("success");
        state.completed.reflex = true;
        state.scores.reflex = Math.max(state.scores.reflex, points);
      } else {
        reflexStatus.textContent = `Un peu lent (${Math.round(reaction)} ms) — réessaie !`;
        reflexStatus.classList.remove("success");
      }
      saveState();
      updateScoreboard();
      reflexStartBtn.disabled = false;
    });

    // Mémoire chroma
    const memoryColors = ["cyan", "rose", "indigo", "lime"];
    const memoryStatus = document.getElementById("memoryStatus");
    const memoryStartBtn = document.getElementById("memoryStart");
    const memoryTiles = Array.from(document.querySelectorAll("#memoryBoard .tile"));
    let memorySequence = [];
    let memoryStep = 0;
    let memoryActive = false;

    function colorToStyle(color) {
      const map = {
        cyan: "rgba(34,211,238,0.28)",
        rose: "rgba(244,114,182,0.28)",
        indigo: "rgba(99,102,241,0.28)",
        lime: "rgba(163,230,53,0.28)",
      };
      return map[color] || "rgba(124,58,237,0.25)";
    }

    function flashTile(tile) {
      const original = tile.style.backgroundColor;
      tile.style.backgroundColor = colorToStyle(tile.dataset.color);
      setTimeout(() => { tile.style.backgroundColor = original; }, 450);
    }

    function playSequence(seq) {
      seq.forEach((color, idx) => {
        const tile = memoryTiles.find(t => t.dataset.color === color);
        setTimeout(() => flashTile(tile), idx * 650);
      });
    }

    function resetMemory() {
      memoryActive = false;
      memoryStep = 0;
      memorySequence = [];
      memoryTiles.forEach(t => t.classList.remove("correct", "wrong"));
    }

    memoryStartBtn.addEventListener("click", () => {
      resetMemory();
      memorySequence = Array.from({ length: 4 }, () => memoryColors[Math.floor(Math.random() * memoryColors.length)]);
      playSequence(memorySequence);
      memoryStatus.textContent = "Reproduis la séquence";
      memoryStatus.classList.remove("success");
      memoryStatus.classList.add("pending");
      memoryActive = true;
    });

    memoryTiles.forEach(tile => {
      tile.addEventListener("click", () => {
        if (!memoryActive) return;
        flashTile(tile);
        const expected = memorySequence[memoryStep];
        const chosen = tile.dataset.color;
        memoryStep++;
        if (chosen !== expected) {
          tile.classList.add("wrong");
          memoryStatus.textContent = "Raté, essaie encore !";
          memoryStatus.classList.remove("success");
          memoryActive = false;
          return;
        }
        if (memoryStep === memorySequence.length) {
          tile.classList.add("correct");
          memoryStatus.textContent = "Séquence validée !";
          memoryStatus.classList.add("success");
          state.completed.memory = true;
          state.scores.memory = Math.max(state.scores.memory, games.memory.max);
          saveState();
          updateScoreboard();
          memoryActive = false;
        }
      });
    });

    // Quiz
    const quizStartBtn = document.getElementById("quizStart");
    const quizStatus = document.getElementById("quizStatus");
    const quizQuestion = document.getElementById("quizQuestion");
    const quizOptions = document.getElementById("quizOptions");
    const quizQuestions = [
      {
        q: "Combien de mini-jeux doivent être validés pour débloquer la récompense ?",
        options: ["2", "3", "6"],
        answer: "6",
      },
      {
        q: "Quel type de jeu teste ta rapidité ?",
        options: ["YuukaFlash", "Yuukolor", "Yuukagram"],
        answer: "YuukaFlash",
      },
      {
        q: "Comment est stockée ta progression ?",
        options: ["Dans ton navigateur", "Sur un compte en ligne", "Elle n'est pas sauvegardée"],
        answer: "Dans ton navigateur",
      },
    ];
    let currentQuizIndex = 0;
    let correctAnswers = 0;
    let quizActive = false;

    function renderQuizQuestion() {
      const { q, options } = quizQuestions[currentQuizIndex];
      quizQuestion.textContent = q;
      quizOptions.innerHTML = "";
      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.className = "btn";
        btn.textContent = opt;
        btn.addEventListener("click", () => handleQuizAnswer(opt));
        quizOptions.appendChild(btn);
      });
    }

    function handleQuizAnswer(choice) {
      if (!quizActive) return;
      const current = quizQuestions[currentQuizIndex];
      if (choice === current.answer) correctAnswers++;
      currentQuizIndex++;
      if (currentQuizIndex >= quizQuestions.length) {
        const points = correctAnswers * 10;
        if (correctAnswers === quizQuestions.length) {
          quizStatus.textContent = "Sans faute !";
          quizStatus.classList.add("success");
          state.completed.quiz = true;
          state.scores.quiz = Math.max(state.scores.quiz, points);
        } else {
          quizStatus.textContent = `${correctAnswers}/3 — réessaie pour valider`;
          quizStatus.classList.remove("success");
          state.scores.quiz = Math.max(state.scores.quiz, points);
        }
        saveState();
        updateScoreboard();
        quizActive = false;
        quizQuestion.textContent = "Quiz terminé, rejoue pour améliorer ton score.";
        quizOptions.innerHTML = "";
        quizStartBtn.disabled = false;
        return;
      }
      renderQuizQuestion();
    }

    quizStartBtn.addEventListener("click", () => {
      currentQuizIndex = 0;
      correctAnswers = 0;
      quizActive = true;
      quizStatus.textContent = "En cours…";
      quizStatus.classList.remove("success");
      quizStatus.classList.add("pending");
      quizStartBtn.disabled = true;
      renderQuizQuestion();
    });

    // Anagramme
    const anagramWords = ["yuuka", "yuukaflash", "yuukwizz", "yuukagram", "yuukode", "yuukadash", "yuukonline"];
    const anagramScramble = document.getElementById("anagramScramble");
    const anagramInput = document.getElementById("anagramInput");
    const anagramStatus = document.getElementById("anagramStatus");
    const anagramNextBtn = document.getElementById("anagramNext");
    const anagramCheckBtn = document.getElementById("anagramCheck");
    let currentAnagram = "";

    function shuffleWord(word) {
      return word.split("").sort(() => Math.random() - 0.5).join("").toUpperCase();
    }

    function loadAnagram() {
      currentAnagram = anagramWords[Math.floor(Math.random() * anagramWords.length)];
      anagramScramble.textContent = shuffleWord(currentAnagram);
      anagramInput.value = "";
      anagramStatus.textContent = "En attente";
      anagramStatus.classList.remove("success");
      anagramStatus.classList.add("pending");
    }

    anagramCheckBtn.addEventListener("click", () => {
      const guess = anagramInput.value.trim().toLowerCase();
      if (!guess) return;
      if (guess === currentAnagram) {
        anagramStatus.textContent = "Trouvé !";
        anagramStatus.classList.add("success");
        state.completed.anagram = true;
        state.scores.anagram = Math.max(state.scores.anagram, games.anagram.max);
        saveState();
        updateScoreboard();
      } else {
        anagramStatus.textContent = "Raté, réessaie ou passe à un autre mot.";
        anagramStatus.classList.remove("success");
      }
    });

    anagramNextBtn.addEventListener("click", loadAnagram);

    // Yuukode (guess)
    const codeStatus = document.getElementById("codeStatus");
    const codeInput = document.getElementById("codeInput");
    const codeTryBtn = document.getElementById("codeTry");
    const codeRestartBtn = document.getElementById("codeRestart");
    let secretCode = 0;
    let codeAttempts = 0;

    function resetCode() {
      secretCode = 1 + Math.floor(Math.random() * 20);
      codeAttempts = 0;
      codeInput.value = "";
      codeStatus.textContent = "Nouveau code généré.";
      codeStatus.classList.remove("success");
      codeStatus.classList.add("pending");
    }

    codeTryBtn.addEventListener("click", () => {
      const val = parseInt(codeInput.value, 10);
      if (Number.isNaN(val)) return;
      codeAttempts++;
      if (val === secretCode) {
        codeStatus.textContent = `Code trouvé en ${codeAttempts} essais !`;
        codeStatus.classList.add("success");
        state.completed.code = true;
        const pts = Math.max(10, games.code.max - (codeAttempts - 1) * 3);
        state.scores.code = Math.max(state.scores.code, pts);
        saveState();
        updateScoreboard();
      } else if (codeAttempts >= 5) {
        codeStatus.textContent = `Perdu ! Le code était ${secretCode}. Relance.`;
        codeStatus.classList.remove("success");
      } else {
        codeStatus.textContent = val < secretCode ? "Plus haut" : "Plus bas";
        codeStatus.classList.remove("success");
      }
    });

    codeRestartBtn.addEventListener("click", resetCode);

    // Clicker
    const clickerStart = document.getElementById("clickerStart");
    const clickerTap = document.getElementById("clickerTap");
    const clickerTimer = document.getElementById("clickerTimer");
    const clickerCount = document.getElementById("clickerCount");
    const clickerStatus = document.getElementById("clickerStatus");
    let clickerClicks = 0;
    let clickerTimeLeft = 10;
    let clickerInterval;
    let clickerActive = false;

    function resetClicker() {
      clearInterval(clickerInterval);
      clickerClicks = 0;
      clickerTimeLeft = 10;
      clickerActive = false;
      clickerCount.textContent = "0 clic";
      clickerTimer.textContent = "10s";
      clickerStatus.textContent = "En attente";
      clickerStatus.classList.remove("success");
      clickerStatus.classList.add("pending");
      clickerTap.disabled = true;
    }

    clickerStart.addEventListener("click", () => {
      resetClicker();
      clickerActive = true;
      clickerTap.disabled = false;
      clickerStatus.textContent = "Go !";
      clickerInterval = setInterval(() => {
        clickerTimeLeft--;
        clickerTimer.textContent = `${clickerTimeLeft}s`;
        if (clickerTimeLeft <= 0) {
          clearInterval(clickerInterval);
          clickerActive = false;
          clickerTap.disabled = true;
          const pts = Math.min(games.clicker.max, clickerClicks);
          if (clickerClicks >= 20) {
            clickerStatus.textContent = `Validé : ${clickerClicks} clics`;
            clickerStatus.classList.add("success");
            state.completed.clicker = true;
            state.scores.clicker = Math.max(state.scores.clicker, pts);
            saveState();
            updateScoreboard();
          } else {
            clickerStatus.textContent = `Seulement ${clickerClicks} clics, retente !`;
            clickerStatus.classList.remove("success");
          }
        }
      }, 1000);
    });

    clickerTap.addEventListener("click", () => {
      if (!clickerActive) return;
      clickerClicks++;
      clickerCount.textContent = `${clickerClicks} clic${clickerClicks > 1 ? "s" : ""}`;
    });

    // Init
    loadState();
    updateScoreboard();
    showHub();
    quizQuestion.textContent = "Prêt à commencer ?";
    loadAnagram();
    resetCode();
    resetClicker();
  </script>
</body>
</html>
